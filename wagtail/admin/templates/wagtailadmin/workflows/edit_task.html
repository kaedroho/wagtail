{% extends "wagtailadmin/base.html" %}
{% load i18n wagtailadmin_tags %}

{% block titletag %}{{ view.page_title }}{% endblock %}

{% block extra_css %}
    {% include "wagtailadmin/pages/_editor_css.html" %}
    {{ edit_handler.form.media.css }}

    {{ view.media.css }}
{% endblock %}

{% block extra_js %}
    {% include "wagtailadmin/pages/_editor_js.html" %}
    {{ edit_handler.form.media.js }}
    {{ edit_handler.html_declarations }}

    {{ view.media.js }}

    <script type="text/javascript">
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('[data-enable-action]').forEach(function (buttonElement) {
                buttonElement.addEventListener('click', function (e) {
                    // Stop the button from submitting the form
                    e.preventDefault();
                    e.stopPropagation();

                    var formElement = document.createElement('form');

                    formElement.action = '{{ view.get_enable_url }}';
                    formElement.method = 'POST';

                    var csrftokenElement = document.createElement('input');
                    csrftokenElement.type = 'hidden';
                    csrftokenElement.name = 'csrfmiddlewaretoken';
                    csrftokenElement.value = '{{ csrf_token|escapejs }}';
                    formElement.appendChild(csrftokenElement);

                    document.body.appendChild(formElement);
                    formElement.submit();
                }, {capture: true});
            })
        });
    </script>
{% endblock %}

{% block content %}

    {% include "wagtailadmin/shared/header.html" with title=view.page_title icon=view.header_icon merged=1 %}

    <form action="{{ view.edit_url }}" enctype="multipart/form-data" method="POST" novalidate>
        {% csrf_token %}

        <ul class="fields nice-padding">
            {% for field in form %}
                {% if not field.is_hidden %}
                    {% include "wagtailadmin/shared/field_as_li.html" %}
                {% else %}
                    {{ field }}
                {% endif %}
            {% endfor %}
        </ul>

        {% block footer %}
            <footer role="contentinfo">
                <ul>
                    <li class="actions">
                        {% block form_actions %}
                            <div class="dropdown dropup dropdown-button match-width">
                                <button type="submit" class="button action-save button-longrunning" data-clicked-text="{% trans 'Savingâ€¦' %}">
                                    <span class="icon icon-spinner"></span><em>{% trans 'Save' %}</em>
                                </button>
                                <div class="dropdown-toggle">{% icon name="arrow-up" %}</div>
                                <ul>
                                    {% if can_enable %}
                                        <li>
                                            <button type="submit" class="button no" data-enable-action>{{ view.enable_item_label }}</button>
                                        </li>
                                    {% endif %}
                                    {% if can_disable %}
                                        <li>
                                            <a href="{{ view.get_delete_url }}" class="button no">{{ view.delete_item_label }}</a>
                                        </li>
                                    {% endif %}
                                </ul>
                            </div>
                        {% endblock %}
                    </li>
                </ul>
            </footer>
        {% endblock %}
    </form>
{% endblock %}
